<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <title>Order Page</title>
    <link rel="stylesheet" type="text/css" href="./order.css">

      <link rel="stylesheet"
       href="//code.jquery.com/ui/3.6.0/themes/smoothness/jquery-ui.css">
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <script src="https://code.jquery.com/ui/3.6.0/jquery-ui.js"></script>
</head>

<body>
<fieldset>
  <body>
    <fieldset>
    <legend align=left style="border:10px solid black" color:white><h1>預約系統</h1></legend>
    
    <hr>
    
    <form>
    
    
    <p>
    <span>
    <strong>預約者：</strong><input id="person" name="name" class="theorder"
    type="text" required autofocus placeholder="喵太郎" >
    <span class="ok">ok</span>
    <br>
    </span>
    </p>

    
    <p>
    <span>
    <strong>聯絡電話：</strong>
    <input id="tele" name="tele" type="tel" required placeholder="0912-345-678" class="theorder">
    <span class="ok">ok</span>
    <br>
    </span>
    </p>
    
    <p>
     <div></div>
     <td><p><strong>預定日期：</strong></p>
     <input id="calendar" name="date" type="date" class="theorder">
     <span class="ok">ok</span>
    <br>
    <script>
        $('#calendar').datepicker(); 
    </script>
    </p>
    
    <p>
     <div></div>
     <td><p><strong>預訂時間：</p>
     <input id="time" name="TIME" type="time" class="theorder">
     <span class="ok">ok</span>
    <br>
    <script>
        $('#time').timepicker();
    </script>
    </p>
    
    <button id="order">確定</button>
    <button id="cancel">清除</button>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        
        const firebaseConfig = {
    apiKey: "AIzaSyCPLgV8D_qfR-G1U51WN1wdXBX9L_-s91E",
    authDomain: "last-110.firebaseapp.com",
    databaseURL: "https://last-110-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "last-110",
    storageBucket: "last-110.appspot.com",
    messagingSenderId: "48692155043",
    appId: "1:48692155043:web:fca0bef4dd869c90a56516"
  };
      
        const app = initializeApp(firebaseConfig);

        import {getDatabase, ref, get, set, child, update, remove}
        from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        const db = getDatabase(app);
        
        var name=document.getElementById("person");
        var num=document.getElementById("tele");
        var da=document.getElementById("calendar");
        var ti=document.getElementById("time");
        var nawr=0, nuwr=0, dawr=0, tiwr=0;
        
        var odBtn = document.getElementById('order');
        var ccBtn = document.getElementById('cancel');v
        
        function InsertData(){
            set(ref(db, 'TheNumber/' + num.value),{
                NameOfG: name.value,
                NameOfG: num.value,
                date: da.value,
                time: ti.value
            })
            .then(()=>{
                alert('data stored sucessfully');
            })
            .catch((error)=>{
                alert('unsuccessful, error' + error);
            });
        }

        function SelectData(){
            const dbref = ref(db);

            get(child(dbref, 'TheNumber/' + num.value))
            .then((snapshot)=>{
                if(snapshot.exists()){
                    name.value = snapshot.val().NameOfG;
                    num.value = snapshot.val().NameOfG;
                    da.value = snapshot.val().date;
                    ti.value = snapshot.val().time;
                }
                else{
                    alert('No Data Found');
                }
            })
            .catch((error)=>{
                alert('unsuccessful, error' + error);
            })
        }

        function UpdateData(){
            update(ref(db, 'TheNumber/' + num.value),{
                NameOfG: name.value,
                NameOfG: num.value,
                date: da.value,
                time: ti.value
            })
            .then(()=>{
                alert('data updated sucessfully');
            })
            .catch((error)=>{
                alert('unsuccessful, error' + error);
            });
        }

        function DeleteData(){
            remove(ref(db,'TheNumber/' + num.value))
            .then(()=>{
                alert('data remove sucessfully');
            })
            .catch((error)=>{
                alert('unsuccessful, error' + error);
            });
        }

        insBtn.addEventListener('click', InsertData);
        selBtn.addEventListener('click', SelectData);
        updBtn.addEventListener('click', UpdateData);
        delBtn.addEventListener('click', DeleteData);
        
        // 用匿名函式設定 '清除' 鈕的動作
        document.getElementById("cancel").onclick = 
          function (){
              name.value=0;
              num.value=0;
              da.value=0;
              ti.value=0;
              nawr=0;
              nuwr=0;
              dawr=0; 
              tiwr=0;
          };
        
        // 用匿名函式設定 '訂購' 鈕的動作
        var btnOrder =document.getElementById("order").onclick=
          function (){
              var name=document.getElementById("person").value;
              var num=document.getElementById("tele").value;
              var da=document.getElementById("calendar").value;
              var ti=document.getElementById("time").value;
              if(name==0) return;
              else if(num==0) return;
              else if(da==0) return;
              else if(ti==0) return;    // 為 0 時不處理
              var msg="";
              if(nawr==0) msg += "訂購者："  + name +"；";
              if(nuwr==0) msg += "連絡電話："  + num +"；";
              if(dawr==0) msg += "預定日期："  + da +"；";
              if(tiwr==0) msg += "預定時間："  + ti 
              alert(msg);
          }
    </script>    

</body>
</html>
